<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/16x16.png"><link rel="shortcut icon" href="/images/favicon/favicon.ico"><link rel="stylesheet" href="/css/index.css"><title>Uniapp ä¸­å¦‚ä½•ä½¿ç”¨ Socket | Personal Hobbies</title><meta name="description" content="Just playing around">
    <link rel="modulepreload" href="/assets/app.90fa381f.js"><link rel="modulepreload" href="/assets/index.html.20330122.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.5a098b48.js"><link rel="modulepreload" href="/assets/index.html.eb9440c9.js">
    <link rel="stylesheet" href="/assets/style.877cd0e4.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">Personal Hobbies</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/lifestyle/" class="nav-link" aria-label="ç”Ÿæ´»"><!--[--><!--]--> ç”Ÿæ´» <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/meditate/" class="nav-link" aria-label="æ€è€ƒ"><!--[--><!--]--> æ€è€ƒ <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/traveling/" class="nav-link" aria-label="æ—…æ¸¸"><!--[--><!--]--> æ—…æ¸¸ <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="âˆšget"><span class="title">âˆšget</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="âˆšget"><span class="title">âˆšget</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/note/" class="nav-link" aria-label="ä¾¿ç­¾"><!--[--><!--]--> ä¾¿ç­¾ <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/data-structures-and-algorithms/" class="nav-link" aria-label="æ•°æ®ç»“æ„ä¸ç®—æ³•"><!--[--><!--]--> æ•°æ®ç»“æ„ä¸ç®—æ³• <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/javascript-note/" class="nav-link" aria-label="javascript ç¬”è®°"><!--[--><!--]--> javascript ç¬”è®° <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/handwritten-code/" class="nav-link" aria-label="æ‰‹å†™ä»£ç "><!--[--><!--]--> æ‰‹å†™ä»£ç  <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/leetcode/" class="nav-link" aria-label="LeetCode"><!--[--><!--]--> LeetCode <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/web-development/" class="nav-link" aria-label="Web Development"><!--[--><!--]--> Web Development <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/uniapp/" class="nav-link router-link-active" aria-label="Uniapp"><!--[--><!--]--> Uniapp <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/git/" class="nav-link" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/workspace/" class="nav-link" aria-label="Workspace"><!--[--><!--]--> Workspace <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/rich1e" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/lifestyle/" class="nav-link" aria-label="ç”Ÿæ´»"><!--[--><!--]--> ç”Ÿæ´» <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/meditate/" class="nav-link" aria-label="æ€è€ƒ"><!--[--><!--]--> æ€è€ƒ <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/traveling/" class="nav-link" aria-label="æ—…æ¸¸"><!--[--><!--]--> æ—…æ¸¸ <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="âˆšget"><span class="title">âˆšget</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="âˆšget"><span class="title">âˆšget</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/note/" class="nav-link" aria-label="ä¾¿ç­¾"><!--[--><!--]--> ä¾¿ç­¾ <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/data-structures-and-algorithms/" class="nav-link" aria-label="æ•°æ®ç»“æ„ä¸ç®—æ³•"><!--[--><!--]--> æ•°æ®ç»“æ„ä¸ç®—æ³• <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/javascript-note/" class="nav-link" aria-label="javascript ç¬”è®°"><!--[--><!--]--> javascript ç¬”è®° <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/handwritten-code/" class="nav-link" aria-label="æ‰‹å†™ä»£ç "><!--[--><!--]--> æ‰‹å†™ä»£ç  <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/leetcode/" class="nav-link" aria-label="LeetCode"><!--[--><!--]--> LeetCode <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/web-development/" class="nav-link" aria-label="Web Development"><!--[--><!--]--> Web Development <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/uniapp/" class="nav-link router-link-active" aria-label="Uniapp"><!--[--><!--]--> Uniapp <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/git/" class="nav-link" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/workspace/" class="nav-link" aria-label="Workspace"><!--[--><!--]--> Workspace <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/rich1e" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item active">Uniapp</p><ul class=""><li><!--[--><a href="/uniapp/uniapp-disable-pagescroll-and-bance/" class="nav-link sidebar-item" aria-label="ç¦æ­¢é¡µé¢æ»šåŠ¨å’Œå›å¼¹æ•ˆæœ"><!--[--><!--]--> ç¦æ­¢é¡µé¢æ»šåŠ¨å’Œå›å¼¹æ•ˆæœ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/uniapp/global-toast-components/" class="nav-link sidebar-item" aria-label="toast_å¦ç±»å…¨å±€ç»„ä»¶çš„å®ç°"><!--[--><!--]--> toast_å¦ç±»å…¨å±€ç»„ä»¶çš„å®ç° <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="Uniapp ä¸­å¦‚ä½•ä½¿ç”¨ Socket"><!--[--><!--]--> Uniapp ä¸­å¦‚ä½•ä½¿ç”¨ Socket <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#socket-å°è£…" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Socket å°è£…"><!--[--><!--]--> Socket å°è£… <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#ä¸»åŠ¨å»ºç«‹è¿æ¥" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="ä¸»åŠ¨å»ºç«‹è¿æ¥"><!--[--><!--]--> ä¸»åŠ¨å»ºç«‹è¿æ¥ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#å¿ƒè·³æœºåˆ¶" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="å¿ƒè·³æœºåˆ¶"><!--[--><!--]--> å¿ƒè·³æœºåˆ¶ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#æ–­çº¿é‡è¿" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="æ–­çº¿é‡è¿"><!--[--><!--]--> æ–­çº¿é‡è¿ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#ä¸»åŠ¨æ–­å¼€" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="ä¸»åŠ¨æ–­å¼€"><!--[--><!--]--> ä¸»åŠ¨æ–­å¼€ <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#å®Œæ•´çš„ä»£ç " class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="å®Œæ•´çš„ä»£ç "><!--[--><!--]--> å®Œæ•´çš„ä»£ç  <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#ref" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Ref"><!--[--><!--]--> Ref <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/uniapp/uniapp-how-to-debug-a-web-project/" class="nav-link sidebar-item" aria-label="Uniappï¼šWeb é¡¹ç›®å¦‚ä½• debug?"><!--[--><!--]--> Uniappï¼šWeb é¡¹ç›®å¦‚ä½• debug? <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="uniapp-ä¸­å¦‚ä½•ä½¿ç”¨-socket" tabindex="-1"><a class="header-anchor" href="#uniapp-ä¸­å¦‚ä½•ä½¿ç”¨-socket" aria-hidden="true">#</a> Uniapp ä¸­å¦‚ä½•ä½¿ç”¨ Socket</h1><nav class="table-of-contents"><ul><li><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#socket-å°è£…" class="router-link-active router-link-exact-active">Socket å°è£…</a><ul><li><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#ä¸»åŠ¨å»ºç«‹è¿æ¥" class="router-link-active router-link-exact-active">ä¸»åŠ¨å»ºç«‹è¿æ¥</a></li><li><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#å¿ƒè·³æœºåˆ¶" class="router-link-active router-link-exact-active">å¿ƒè·³æœºåˆ¶</a></li><li><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#æ–­çº¿é‡è¿" class="router-link-active router-link-exact-active">æ–­çº¿é‡è¿</a></li><li><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#ä¸»åŠ¨æ–­å¼€" class="router-link-active router-link-exact-active">ä¸»åŠ¨æ–­å¼€</a></li></ul></li><li><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#å®Œæ•´çš„ä»£ç " class="router-link-active router-link-exact-active">å®Œæ•´çš„ä»£ç </a></li><li><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#ref" class="router-link-active router-link-exact-active">Ref</a></li></ul></nav><p>é€šå¸¸æ¥è®²ï¼Œæœ‰ 3 ç§æ–¹å¼ï¼š</p><ol><li>ç›´æ¥ä½¿ç”¨ JS åŸç”Ÿæä¾›çš„ WebSocket æ–¹æ³•ï¼›</li><li>ä½¿ç”¨ uniapp å†…ç½®çš„ WebSocket æ–¹æ³•ï¼›</li><li>ä½¿ç”¨ Socket.io å¥—ä»¶ï¼›</li></ol><p>è¿™äº›æ–¹å¼å„æœ‰åƒç§‹ï¼Œå¦‚ä½•é€‰æ‹©ï¼Œè¦æ ¹æ®å®é™…æƒ…å†µå†³å®šã€‚</p><table><thead><tr><th style="text-align:left;"></th><th style="text-align:center;">å…¼å®¹æ€§ <div style="width:100px;"></div></th><th style="text-align:center;">ä¸Šæ‰‹éš¾åº¦ <div style="width:100px;"></div></th><th>åŠŸèƒ½å®Œå¤‡æ€§ <div style="width:450px;"></div></th><th style="text-align:center;">ç¤¾åŒºå’Œç¬¬ä¸‰æ–¹<div style="width:100px;"></div></th></tr></thead><tbody><tr><td style="text-align:left;">åŸç”Ÿ WebSocket</td><td style="text-align:center;">å¥½</td><td style="text-align:center;">å®¹æ˜“</td><td>æ— ï¼Œéœ€è¦è‡ªè¡Œå¼€å‘</td><td style="text-align:center;">æ´»è·ƒ</td></tr><tr><td style="text-align:left;">uni.connectSocket</td><td style="text-align:center;">å¥½</td><td style="text-align:center;">å®¹æ˜“</td><td>ä¸€èˆ¬ï¼Œåªæœ‰ç®€å•å°è£…ï¼Œæ»¡è¶³ä¸äº†ä¸šåŠ¡åœºæ™¯</td><td style="text-align:center;">æ´»è·ƒ</td></tr><tr><td style="text-align:left;">Socket.io</td><td style="text-align:center;">ä¸€èˆ¬</td><td style="text-align:center;">éš¾</td><td>Uniapp å¹³å°ç¼–è¯‘çš„ JS ç‰ˆæœ¬ä¸ Socket.io å­˜åœ¨å…¼å®¹æ€§ï¼Œæ–°ç‰ˆæœ¬çš„ Socket.io ä¼šå‡ºç°é”™è¯¯ï¼Œè€ç‰ˆæœ¬æœ‰å¯èƒ½å¯ä»¥å·¥ä½œï¼Œä½†å­˜åœ¨å¾ˆå¤šä¸ç¡®å®šæ€§ã€‚æ¯•ç«Ÿ Socket.io æ˜¯å…ˆå‡ºæ¥çš„ï¼Œåé¢æœ‰äº† Uniapp è¿™ä¸ªå¹³å°ï¼Œä½†æ˜¯ç¼ºå°‘å®˜æ–¹çš„é€‚é…å·¥ä½œï¼Œæ‰€ä»¥äºŒè€…å…¼å®¹æ€§å·®ã€‚</td><td style="text-align:center;">æ´»è·ƒ</td></tr></tbody></table><blockquote><p>Socket.io åœ¨åº”ç”¨å¸‚åœºä¸Šä¹Ÿæœ‰ç¬¬ä¸‰æ–¹å°è£…çš„æ’ä»¶ã€‚æœ‰äººå®‰è£…æˆåŠŸï¼Œä¹Ÿæœ‰äººå¤±è´¥â€¦â€¦æ¯”å¦‚æˆ‘è‡ªå·±ã€‚ã€‚ã€‚</p></blockquote><h2 id="socket-å°è£…" tabindex="-1"><a class="header-anchor" href="#socket-å°è£…" aria-hidden="true">#</a> Socket å°è£…</h2><p>ä» MDN å¯ä»¥äº†è§£åˆ°ï¼ŒJS çš„ WebSocket å¯¹è±¡æä¾›äº†ç”¨äºåˆ›å»ºå’Œç®¡ç† WebSocket è¿æ¥ï¼Œä»¥åŠå¯ä»¥é€šè¿‡è¯¥è¿æ¥å‘é€å’Œæ¥æ”¶æ•°æ®çš„ APIã€‚</p><p>åœ¨è¿™äº›åŸºç¡€ API ä¹‹ä¸Šï¼Œæˆ‘ä»¬éœ€è¦å°è£…ä»¥ä¸‹åŠŸèƒ½ï¼š</p><ol><li>ä¸»åŠ¨å»ºç«‹è¿æ¥</li><li>å¿ƒè·³æœºåˆ¶</li><li>æ–­çº¿é‡è¿</li><li>ä¸»åŠ¨æ–­å¼€</li></ol><p>å±•ç¤ºä¸€æ®µ MDN çš„ç¤ºä¾‹ä»£ç <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// Create WebSocket connection.</span>
<span class="token keyword">const</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">&quot;ws://localhost:8080&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Connection opened</span>
socket<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Server!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Listen for messages</span>
socket<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Message from server &quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>è¿™æ®µä»£ç æ˜¯æ­£ç¡®çš„ï¼Œä¹Ÿå¯ä»¥å·¥ä½œã€‚ä½†æ˜¯å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p><ol><li>é¢å‘è¿‡ç¨‹çš„ä»£ç è°ƒç”¨ï¼Œéš¾ä»¥å¤ç”¨ï¼›</li><li>ç¼ºå°‘å°è£…ï¼Œéš¾ä»¥æ‰©å±•ï¼›</li><li>callback hell<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>ï¼Œå¾ˆéš¾ç›´è§‚åœ°è·å¾—ä»£ç æ‰§è¡Œåçš„æ­£ç¡®æ€§ï¼›</li></ol><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œç°åœ¨å¼€å§‹åŠ¨æ‰‹å°è£…å§ã€‚</p><blockquote><p>å½“å‰ä¸»è¦è®²è¿° Uniapp å¹³å°ä¸‹å¦‚ä½•å°è£…ã€‚</p></blockquote><h3 id="ä¸»åŠ¨å»ºç«‹è¿æ¥" tabindex="-1"><a class="header-anchor" href="#ä¸»åŠ¨å»ºç«‹è¿æ¥" aria-hidden="true">#</a> ä¸»åŠ¨å»ºç«‹è¿æ¥</h3><p>åˆ›å»ºç®€å•çš„ Socket è¿æ¥ï¼Œå¾ˆéš¾æ»¡è¶³æ—¥å¸¸å¼€å‘éœ€æ±‚ï¼Œæœ€å¸¸è§çš„è¦æ±‚å°±æ˜¯ <strong>URL å‚æ•°æ‹¼æ¥å’Œæ”¯æŒå­è·¯å¾„</strong>ã€‚ä¾‹å¦‚ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>wss<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>socket<span class="token punctuation">.</span>serve<span class="token operator">/</span>sub<span class="token operator">-</span>path<span class="token operator">?</span>token<span class="token operator">=</span>xxxx<span class="token operator">&amp;</span>param1<span class="token operator">=</span>x<span class="token operator">&amp;</span>param2<span class="token operator">=</span>x<span class="token operator">&amp;</span>param3<span class="token operator">=</span>x<span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">&amp;</span>param<span class="token operator">=</span>x
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>API å¯ä»¥è¿™æ ·è®¾è®¡ï¼š</p><ul><li><code>backendUrl</code> socket æœåŠ¡åœ°å€</li><li><code>path</code> å­è·¯å¾„</li><li><code>query</code> URL å‚æ•°</li></ul><p>ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * å°†å¯¹è±¡è½¬æ¢æˆ URL æ‹¼æ¥å‚æ•°
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">obj</span>
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">requestStr</span>
 * <span class="token keyword">@returns</span>
 */</span>
<span class="token keyword">const</span> obj2Params <span class="token operator">=</span> <span class="token punctuation">(</span>obj<span class="token punctuation">,</span> requestStr <span class="token operator">=</span> <span class="token string">&#39;?&#39;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> params <span class="token operator">=</span> requestStr
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> p <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    params <span class="token operator">+=</span> p <span class="token operator">+</span> <span class="token string">&#39;=&#39;</span> <span class="token operator">+</span> obj<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&#39;&amp;&#39;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> params<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> params<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
  backendUrl<span class="token operator">:</span> <span class="token string">&#39;socket.serve&#39;</span><span class="token punctuation">,</span>
  path<span class="token operator">:</span> <span class="token string">&#39;/socket.io/&#39;</span><span class="token punctuation">,</span>
  query<span class="token operator">:</span> <span class="token punctuation">{</span>
    transport<span class="token operator">:</span> <span class="token string">&#39;websocket&#39;</span><span class="token punctuation">,</span>
    token<span class="token operator">:</span> <span class="token string">&#39;your-token&#39;</span><span class="token punctuation">,</span>
    device<span class="token operator">:</span> <span class="token string">&#39;app&#39;</span><span class="token punctuation">,</span>
    <span class="token constant">EIO</span><span class="token operator">:</span> <span class="token string">&#39;4&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token function">obj2Params</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>query<span class="token punctuation">)</span>
<span class="token keyword">const</span> wsUrl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span>backendUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>query<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>

<span class="token comment">// åˆ›å»º WebSocket è¿æ¥</span>
<span class="token keyword">const</span> socketTask <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">connectSocket</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  url<span class="token operator">:</span> wsUrl<span class="token punctuation">,</span>
  <span class="token function-variable function">complete</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h3 id="å¿ƒè·³æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#å¿ƒè·³æœºåˆ¶" aria-hidden="true">#</a> å¿ƒè·³æœºåˆ¶</h3><blockquote><p>å¿ƒè·³æœºåˆ¶æ˜¯å®šæ—¶å‘é€ä¸€ä¸ªè‡ªå®šä¹‰çš„æ•°æ®ç»“æ„ä½“ï¼Œè®©å¯¹æ–¹çŸ¥é“è‡ªå·±è¿˜æ´»ç€ï¼Œä»¥ç¡®ä¿è¿æ¥çš„æœ‰æ•ˆæ€§çš„æœºåˆ¶ã€‚</p></blockquote><p>è¿™é‡Œï¼Œæˆ‘ä»¬å‚è€ƒ Socket.ioï¼Œä»–ä»¬å»ºç«‹äº†ä¸€ä¸ª <code>ping/pong</code> çš„æœºåˆ¶<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>ï¼Œç”¨æ¥ç¡®ä¿å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯è¿æ¥çš„æœ‰æ•ˆæ€§ã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// åˆ›å»º WebSocket è¿æ¥</span>
<span class="token keyword">const</span> socketTask <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">connectSocket</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  url<span class="token operator">:</span> wsUrl<span class="token punctuation">,</span>
  <span class="token function-variable function">complete</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// å¿ƒè·³é—´éš”ã€é‡è¿ websocket é—´éš”ï¼Œ15 ç§’</span>
<span class="token keyword">const</span> interval <span class="token operator">=</span> <span class="token number">15000</span>

<span class="token keyword">const</span> <span class="token function-variable function">onHeartBeat</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    socketTask<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      data<span class="token operator">:</span> <span class="token string">&#39;3&#39;</span><span class="token punctuation">,</span>
      <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\nğŸš€ ~ å¿ƒè·³å‘é€æˆåŠŸï¼&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;ğŸš€ ~å¿ƒè·³å‘é€å¤±è´¥&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> interval<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// å‘é€å¿ƒè·³</span>
<span class="token function">onHeartBeat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="æ–­çº¿é‡è¿" tabindex="-1"><a class="header-anchor" href="#æ–­çº¿é‡è¿" aria-hidden="true">#</a> æ–­çº¿é‡è¿</h3><p>å®é™…ç”Ÿæ´»ä¸­ï¼Œç”±äºç½‘ç»œå»¶è¿Ÿã€é”™è¯¯å¼‚å¸¸æˆ–è€…æœåŠ¡å™¨æ›´æ–°é‡å¯ç­‰æ„å¤–çªå‘æƒ…å†µï¼Œä¹‹å‰å»ºç«‹çš„ socket è¿æ¥å¯èƒ½è¢«ä¸­æ–­ã€‚é¢å¯¹è¿™æ ·çš„æƒ…å†µï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ</p><p>é€šå¸¸çš„åšæ³•æ˜¯ï¼Œåœ¨ä¸æ‰“æ‰°ç”¨æˆ·ã€ç”¨æˆ·æ— æ„Ÿçš„æƒ…å†µä¸‹ï¼Œç¨‹åºè‡ªåŠ¨é‡æ–°è¿æ¥æœåŠ¡ï¼Œç¡®ä¿è¿æ¥æ­£å¸¸ã€‚ä¸ºäº†ä¿è¯è¿æ¥æˆåŠŸï¼Œ<strong>ä¸€èˆ¬ä¼šå°è¯•å¤šæ¬¡ï¼Œå½“è¶…è¿‡è¿æ¥æ¬¡æ•°çš„ä¸Šé™æ—¶ï¼Œæ‰æ”¾å¼ƒè‡ªåŠ¨è¿æ¥ã€‚</strong> è®¾ç½®ä¸Šé™ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢æ— ä¼‘æ­¢çš„æ— æ•ˆè¿æ¥ï¼Œå¼•å‘å…¶å®ƒé—®é¢˜ã€‚</p><p>æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// é‡æ–°è¿æ¥æ¬¡æ•°</span>
<span class="token keyword">let</span> reconnectTime <span class="token operator">=</span> <span class="token number">1</span>
<span class="token comment">// é‡æ–°è¿æ¥ Timer</span>
<span class="token keyword">let</span> reconnectTimer <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token comment">// é—´éš” 15 ç§’</span>
<span class="token keyword">const</span> interval <span class="token operator">=</span> <span class="token number">15000</span>
<span class="token comment">// é‡è¿æœ€å¤§æ¬¡æ•°</span>
<span class="token keyword">const</span> maxReconnectMaxTime <span class="token operator">=</span> <span class="token number">5</span>

<span class="token keyword">const</span> <span class="token function-variable function">onReconnect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">clearTimeout</span><span class="token punctuation">(</span>reconnectTimer<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>reconnectTime <span class="token operator">&lt;</span> maxReconnectMaxTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    reconnectTimer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ğŸš€ ~ ç¬¬ã€</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>reconnectTime<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ã€‘æ¬¡é‡æ–°è¿æ¥ä¸­â€¦â€¦</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token comment">// é‡æ–°è¿æ¥</span>
      <span class="token comment">// CreateSocket()</span>
      reconnectTime<span class="token operator">++</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> interval<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    uni<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">&#39;æç¤º&#39;</span><span class="token punctuation">,</span>
      content<span class="token operator">:</span> <span class="token string">&#39;socket è¿æ¥å¤±è´¥ ~&#39;</span><span class="token punctuation">,</span>
      showCancel<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      confirmText<span class="token operator">:</span> <span class="token string">&#39;æˆ‘çŸ¥é“äº†&#39;</span><span class="token punctuation">,</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// something</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// å°è¯•é‡æ–°è¿æ¥</span>
<span class="token function">onReconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="ä¸»åŠ¨æ–­å¼€" tabindex="-1"><a class="header-anchor" href="#ä¸»åŠ¨æ–­å¼€" aria-hidden="true">#</a> ä¸»åŠ¨æ–­å¼€</h3><p>å½“ç”¨æˆ·é€€å‡ºç™»å½•ï¼Œæˆ–è€…ä¸»åŠ¨æ–­å¼€ socket è¿æ¥æ—¶ã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// åˆ›å»º WebSocket è¿æ¥</span>
<span class="token keyword">const</span> socketTask <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">connectSocket</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  url<span class="token operator">:</span> wsUrl<span class="token punctuation">,</span>
  <span class="token function-variable function">complete</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">close</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  socketTask<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// å…³é—­ websocket</span>
<span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="å®Œæ•´çš„ä»£ç " tabindex="-1"><a class="header-anchor" href="#å®Œæ•´çš„ä»£ç " aria-hidden="true">#</a> å®Œæ•´çš„ä»£ç </h2><p>ç»¼åˆä»¥ä¸Šå†…å®¹ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><details class="custom-container details"><summary>ç‚¹å‡»æŸ¥çœ‹ä»£ç </summary><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">WSocket</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// çŠ¶æ€</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">&#39;notConnected&#39;</span>
    <span class="token comment">// é…ç½®</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options
    <span class="token comment">// WS å®ä¾‹</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>socketTask <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token comment">// å¿ƒè·³é—´éš”ã€é‡è¿ websocket é—´éš”ï¼Œ15 ç§’</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>interval <span class="token operator">=</span> <span class="token number">15000</span>
    <span class="token comment">// é‡è¿æœ€å¤§æ¬¡æ•°</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>maxReconnectMaxTime <span class="token operator">=</span> <span class="token number">5</span>
    <span class="token comment">// æ­£å¸¸å…³é—­</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>normalCloseFlag <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token comment">// é‡æ–°è¿æ¥æ¬¡æ•°</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>reconnectTime <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token comment">// é‡æ–°è¿æ¥ Timer</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>reconnectTimer <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token comment">// å¿ƒè·³ Timer</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>heartTimer <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token comment">// å‘èµ·è¿æ¥</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initSocket</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>token<span class="token punctuation">)</span>

    <span class="token comment">// å…³é—­ WS</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">close</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// æ­£å¸¸å…³é—­çŠ¶æ€</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>normalCloseFlag <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token comment">// å…³é—­ websocket</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>socketTask<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// å…³é—­å¿ƒè·³å®šæ—¶å™¨</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>heartTimer<span class="token punctuation">)</span>
      <span class="token comment">// å…³é—­é‡è¿å®šæ—¶å™¨</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reconnectTimer<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token doc-comment comment">/**
   * å°†å¯¹è±¡è½¬æ¢æˆ URL æ‹¼æ¥å‚æ•°
   * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">obj</span>
   * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">requestStr</span>
   * <span class="token keyword">@returns</span>
   */</span>
  <span class="token function">obj2Params</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> requestStr<span class="token operator">=</span> <span class="token string">&#39;?&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> params <span class="token operator">=</span>requestStr
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> p <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      params <span class="token operator">+=</span> p <span class="token operator">+</span> <span class="token string">&#39;=&#39;</span> <span class="token operator">+</span> obj<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&#39;&amp;&#39;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> params<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> params<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">getBackEndUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>ncsUrl <span class="token operator">&amp;&amp;</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>ncsUrl<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>
      <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">https:\/\/([^/]+)\/api\/ncs_msg</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span>
      <span class="token string">&#39;wss://$1&#39;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">getSocketUrl</span><span class="token punctuation">(</span><span class="token parameter">token</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
      backEndUrl<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getBackEndUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      path<span class="token operator">:</span> <span class="token string">&#39;/socket.io/&#39;</span><span class="token punctuation">,</span>
      query<span class="token operator">:</span> <span class="token punctuation">{</span>
        transport<span class="token operator">:</span> <span class="token string">&#39;websocket&#39;</span><span class="token punctuation">,</span>
        token<span class="token punctuation">,</span>
        device<span class="token operator">:</span> <span class="token string">&#39;app&#39;</span><span class="token punctuation">,</span>
        <span class="token constant">EIO</span><span class="token operator">:</span> <span class="token string">&#39;4&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">obj2Params</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>query<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span>backEndUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>query<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span>

  <span class="token function">getSocketTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>socketTask
  <span class="token punctuation">}</span>

  <span class="token function">initSocket</span><span class="token punctuation">(</span><span class="token parameter">token</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span>
      <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;Socket init failed, token is required !!!&#39;</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> socketUrl <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSocketUrl</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>

    <span class="token comment">// åˆ›å»º WebSocket è¿æ¥</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>socketTask <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">connectSocket</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      url<span class="token operator">:</span> socketUrl<span class="token punctuation">,</span>
      <span class="token function-variable function">complete</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">watchWS</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">watchWS</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ç›‘å¬ WebSocket è¿æ¥æ‰“å¼€äº‹ä»¶</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>socketTask<span class="token punctuation">.</span><span class="token function">onOpen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">&#39;connected&#39;</span>
      <span class="token comment">// è¿æ¥æˆåŠŸ</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>onConnected <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span><span class="token function">onConnected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>socketTask<span class="token punctuation">)</span>
      <span class="token comment">// é‡ç½®è¿æ¥æ¬¡æ•°</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>reconnectTime <span class="token operator">=</span> <span class="token number">1</span>
      <span class="token comment">// å‘é€å¿ƒè·³</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onHeartBeat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// ç›‘å¬æ¶ˆæ¯</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// å…³é—­ Toast</span>
      uni<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// ç›‘å¬ websocket é”™è¯¯</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>socketTask<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// å…³é—­å¹¶é‡è¿</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>socketTask<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// ç›‘å¬ WebSocket è¿æ¥å…³é—­äº‹ä»¶</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>socketTask<span class="token punctuation">.</span><span class="token function">onClose</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// è¿æ¥é”™è¯¯ï¼Œå‘èµ·é‡è¿æ¥</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>normalCloseFlag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onDisconnected</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ç›‘å¬æ¶ˆæ¯</span>
  <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ç›‘å¬ websocket æ”¶åˆ°æ¶ˆæ¯</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>socketTask<span class="token punctuation">.</span><span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">//æ”¶åˆ°æ¶ˆæ¯</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>onMessage <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span><span class="token function">onMessage</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&#39;ğŸš€ ~ Not listening to the message, reason:&#39;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// æ–­å¼€è¿æ¥</span>
  <span class="token function">onDisconnected</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">&#39;notConnected&#39;</span>
    <span class="token comment">// å…³é—­å¿ƒè·³</span>
    <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>heartTimer<span class="token punctuation">)</span>
    <span class="token comment">// å°è¯•é‡æ–°è¿æ¥</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onReconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token doc-comment comment">/** æ–­çº¿é‡è¿ */</span>
  <span class="token function">onReconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reconnectTimer<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reconnectTime <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxReconnectMaxTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>reconnectTimer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ğŸš€ ~ Reconnect for the ã€</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>reconnectTime<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> ã€‘ time</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token comment">// é‡æ–°è¿æ¥</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initSocket</span><span class="token punctuation">(</span><span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>token<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>reconnectTime<span class="token operator">++</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>interval<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      uni<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        title<span class="token operator">:</span> <span class="token string">&#39;tips&#39;</span><span class="token punctuation">,</span>
        content<span class="token operator">:</span> <span class="token string">&#39;socket Connection failed ~&#39;</span><span class="token punctuation">,</span>
        showCancel<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        confirmText<span class="token operator">:</span> <span class="token string">&#39;I got it.&#39;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// something</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token doc-comment comment">/** å¿ƒè·³æ£€æŸ¥ **/</span>
  <span class="token function">onHeartBeat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>heartTimer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>socketTask<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        data<span class="token operator">:</span> <span class="token string">&#39;3&#39;</span><span class="token punctuation">,</span>
        <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\nğŸš€ ~ Heartbeat Sent Successfully!&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;ğŸš€ ~ Heartbeat Send Failure&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>interval<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// å¯¹å¤–æš´éœ²å®ä¾‹åŒ–æ–¹æ³•</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">createSocket</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">WSocket</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br></div></div></details><p>è°ƒç”¨æ–¹å¼</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token function">createNCSocket</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  token<span class="token punctuation">,</span>
  <span class="token function-variable function">onMessage</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// some thing</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// è·å– ws å®ä¾‹</span>
ws<span class="token punctuation">.</span><span class="token function">getSocketTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// æ³¨å†Œç›‘å¬äº‹ä»¶</span>
ws<span class="token punctuation">.</span><span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// å…³é—­ ws</span>
ws<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="ref" tabindex="-1"><a class="header-anchor" href="#ref" aria-hidden="true">#</a> Ref</h2><ul><li><a href="https://juejin.cn/post/7144913531664597029" target="_blank" rel="noopener noreferrer">uniapp å³æ—¶èŠå¤© websocket å°è£…ï¼ˆå»ºç«‹è¿æ¥ã€æ–­çº¿é‡è¿ã€å¿ƒè·³æœºåˆ¶ã€ä¸»åŠ¨å…³é—­ï¼‰ä½¿ç”¨Â SocketTaskÂ çš„æ–¹å¼ - æ˜é‡‘<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li><li><a href="https://juejin.cn/post/7438840219438301221" target="_blank" rel="noopener noreferrer">åŸºäº uniapp ä½¿ç”¨ websocket è¿›è¡Œå®æ—¶é€šè®¯æœ€è¿‘åœ¨åšä¸€ä¸ªèµ›äº‹çš„éœ€æ±‚ï¼Œéœ€è¦ä½¿ç”¨å®æ—¶é€šè®¯å®ç°æˆ¿é—´å†…äº¤æ¢ä½ç½®ï¼Œè½¬è®©æˆ¿ä¸»ï¼Œ - æ˜é‡‘<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li><li><a href="https://juejin.cn/post/6933833582716813325" target="_blank" rel="noopener noreferrer">uni-app ä½¿ç”¨ websocketï¼ˆå¿ƒè·³æœºåˆ¶ï¼‰1. ä¸ºä»€ä¹ˆå«å¿ƒè·³åŒ…å‘¢ï¼Ÿå®ƒå°±åƒå¿ƒè·³ä¸€æ ·æ¯éš”å›ºå®šçš„æ—¶é—´å‘ä¸€æ¬¡ï¼Œæ¥å‘Šè¯‰æœåŠ¡ - æ˜é‡‘<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li><li><a href="https://juejin.cn/post/7425822400178470949" target="_blank" rel="noopener noreferrer">WebSocket å¿ƒè·³æœºåˆ¶çš„åŸç†ä½ çŸ¥é“å¤šå°‘ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å¿ƒè·³æ£€æµ‹ï¼Ÿæ­£å¸¸çš„æƒ…å†µå®¢æˆ·ç«¯æ–­å¼€è¿æ¥ä¼šå‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ª fin åŒ…ï¼Œæœ - æ˜é‡‘<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li><li><a href="https://juejin.cn/post/7346919387353219106" target="_blank" rel="noopener noreferrer">ä¸ºä»€ä¹ˆé¢è¯•å®˜éƒ½çˆ±é—® websocketï¼Ÿä»€ä¹ˆæ˜¯ webSocketï¼Ÿç®€å•æ¥è¯´ï¼šwebSocket å°±æ˜¯æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ç›¸äº’ä¸»åŠ¨ - æ˜é‡‘<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li><li><a href="https://juejin.cn/post/7346471697162649634" target="_blank" rel="noopener noreferrer">5 åˆ†é’Ÿä» 0 åˆ° 1ï¼Œå­¦ä¼š webSocket çš„ä½¿ç”¨ä»€ä¹ˆæ˜¯ webSocketï¼Ÿä¼˜ç‚¹ï¼šåŸºäº TCP åè®®ï¼šWebSocket å»ºç«‹ - æ˜é‡‘<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li><li><a href="https://uniapp.dcloud.net.cn/api/request/websocket.html" target="_blank" rel="noopener noreferrer">uni.connectSocket(OBJECT) | uni-app å®˜ç½‘<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li><li><a href="https://juejin.cn/post/7371365854012276747" target="_blank" rel="noopener noreferrer">èµ¶å¿«æ”¶è—ï¼å…¨ç½‘æœ€ä½³ websocket å°è£…ï¼šå®Œç¾æ”¯æŒæ–­ç½‘é‡è¿ã€è‡ªåŠ¨å¿ƒè·³ï¼ç®€ä»‹ websocket åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œæ˜¯ä¸€ä¸ªå¿…é¡»æŒ - æ˜é‡‘<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li></ul><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket" target="_blank" rel="noopener noreferrer">WebSocket - Web API | MDN<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> <a href="#fnref1" class="footnote-backref">â†©ï¸</a></p></li><li id="fn2" class="footnote-item"><p><a href="http://callbackhell.com/" target="_blank" rel="noopener noreferrer">å›è°ƒåœ°ç‹± --- Callback Hell<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> <a href="#fnref2" class="footnote-backref">â†©ï¸</a></p></li><li id="fn3" class="footnote-item"><p><a href="https://socket.io/zh-CN/how-to/build-a-basic-client#heartbeat" target="_blank" rel="noopener noreferrer">How to build a basic Socket.IO client | Socket.IO<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> <a href="#fnref3" class="footnote-backref">â†©ï¸</a></p></li></ol></section><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">6/9/2025, 9:37:42 AM</span></div><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"> â† <a href="/uniapp/global-toast-components/" class="nav-link" aria-label="toast_å¦ç±»å…¨å±€ç»„ä»¶çš„å®ç°"><!--[--><!--]--> toast_å¦ç±»å…¨å±€ç»„ä»¶çš„å®ç° <!--[--><!--]--></a></span><span class="next"><a href="/uniapp/uniapp-how-to-debug-a-web-project/" class="nav-link" aria-label="Uniappï¼šWeb é¡¹ç›®å¦‚ä½• debug?"><!--[--><!--]--> Uniappï¼šWeb é¡¹ç›®å¦‚ä½• debug? <!--[--><!--]--></a> â†’ </span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.90fa381f.js" defer></script>
  </body>
</html>
