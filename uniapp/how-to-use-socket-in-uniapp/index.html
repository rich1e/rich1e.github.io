<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/16x16.png"><link rel="shortcut icon" href="/images/favicon/favicon.ico"><link rel="stylesheet" href="/css/index.css"><title>Uniapp 中如何使用 Socket | Personal Hobbies</title><meta name="description" content="Just playing around">
    <link rel="modulepreload" href="/assets/app.90fa381f.js"><link rel="modulepreload" href="/assets/index.html.20330122.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.5a098b48.js"><link rel="modulepreload" href="/assets/index.html.eb9440c9.js">
    <link rel="stylesheet" href="/assets/style.877cd0e4.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">Personal Hobbies</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/lifestyle/" class="nav-link" aria-label="生活"><!--[--><!--]--> 生活 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/meditate/" class="nav-link" aria-label="思考"><!--[--><!--]--> 思考 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/traveling/" class="nav-link" aria-label="旅游"><!--[--><!--]--> 旅游 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="√get"><span class="title">√get</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="√get"><span class="title">√get</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/note/" class="nav-link" aria-label="便签"><!--[--><!--]--> 便签 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/data-structures-and-algorithms/" class="nav-link" aria-label="数据结构与算法"><!--[--><!--]--> 数据结构与算法 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/javascript-note/" class="nav-link" aria-label="javascript 笔记"><!--[--><!--]--> javascript 笔记 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/handwritten-code/" class="nav-link" aria-label="手写代码"><!--[--><!--]--> 手写代码 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/leetcode/" class="nav-link" aria-label="LeetCode"><!--[--><!--]--> LeetCode <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/web-development/" class="nav-link" aria-label="Web Development"><!--[--><!--]--> Web Development <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/uniapp/" class="nav-link router-link-active" aria-label="Uniapp"><!--[--><!--]--> Uniapp <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/git/" class="nav-link" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/workspace/" class="nav-link" aria-label="Workspace"><!--[--><!--]--> Workspace <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/rich1e" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/lifestyle/" class="nav-link" aria-label="生活"><!--[--><!--]--> 生活 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/meditate/" class="nav-link" aria-label="思考"><!--[--><!--]--> 思考 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/traveling/" class="nav-link" aria-label="旅游"><!--[--><!--]--> 旅游 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="√get"><span class="title">√get</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="√get"><span class="title">√get</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/note/" class="nav-link" aria-label="便签"><!--[--><!--]--> 便签 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/data-structures-and-algorithms/" class="nav-link" aria-label="数据结构与算法"><!--[--><!--]--> 数据结构与算法 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/javascript-note/" class="nav-link" aria-label="javascript 笔记"><!--[--><!--]--> javascript 笔记 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/handwritten-code/" class="nav-link" aria-label="手写代码"><!--[--><!--]--> 手写代码 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/leetcode/" class="nav-link" aria-label="LeetCode"><!--[--><!--]--> LeetCode <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/web-development/" class="nav-link" aria-label="Web Development"><!--[--><!--]--> Web Development <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/uniapp/" class="nav-link router-link-active" aria-label="Uniapp"><!--[--><!--]--> Uniapp <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/git/" class="nav-link" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/workspace/" class="nav-link" aria-label="Workspace"><!--[--><!--]--> Workspace <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/rich1e" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item active">Uniapp</p><ul class=""><li><!--[--><a href="/uniapp/uniapp-disable-pagescroll-and-bance/" class="nav-link sidebar-item" aria-label="禁止页面滚动和回弹效果"><!--[--><!--]--> 禁止页面滚动和回弹效果 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/uniapp/global-toast-components/" class="nav-link sidebar-item" aria-label="toast_另类全局组件的实现"><!--[--><!--]--> toast_另类全局组件的实现 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="Uniapp 中如何使用 Socket"><!--[--><!--]--> Uniapp 中如何使用 Socket <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#socket-封装" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Socket 封装"><!--[--><!--]--> Socket 封装 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#主动建立连接" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="主动建立连接"><!--[--><!--]--> 主动建立连接 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#心跳机制" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="心跳机制"><!--[--><!--]--> 心跳机制 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#断线重连" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="断线重连"><!--[--><!--]--> 断线重连 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#主动断开" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="主动断开"><!--[--><!--]--> 主动断开 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#完整的代码" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="完整的代码"><!--[--><!--]--> 完整的代码 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#ref" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Ref"><!--[--><!--]--> Ref <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/uniapp/uniapp-how-to-debug-a-web-project/" class="nav-link sidebar-item" aria-label="Uniapp：Web 项目如何 debug?"><!--[--><!--]--> Uniapp：Web 项目如何 debug? <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="uniapp-中如何使用-socket" tabindex="-1"><a class="header-anchor" href="#uniapp-中如何使用-socket" aria-hidden="true">#</a> Uniapp 中如何使用 Socket</h1><nav class="table-of-contents"><ul><li><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#socket-封装" class="router-link-active router-link-exact-active">Socket 封装</a><ul><li><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#主动建立连接" class="router-link-active router-link-exact-active">主动建立连接</a></li><li><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#心跳机制" class="router-link-active router-link-exact-active">心跳机制</a></li><li><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#断线重连" class="router-link-active router-link-exact-active">断线重连</a></li><li><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#主动断开" class="router-link-active router-link-exact-active">主动断开</a></li></ul></li><li><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#完整的代码" class="router-link-active router-link-exact-active">完整的代码</a></li><li><a aria-current="page" href="/uniapp/how-to-use-socket-in-uniapp/#ref" class="router-link-active router-link-exact-active">Ref</a></li></ul></nav><p>通常来讲，有 3 种方式：</p><ol><li>直接使用 JS 原生提供的 WebSocket 方法；</li><li>使用 uniapp 内置的 WebSocket 方法；</li><li>使用 Socket.io 套件；</li></ol><p>这些方式各有千秋，如何选择，要根据实际情况决定。</p><table><thead><tr><th style="text-align:left;"></th><th style="text-align:center;">兼容性 <div style="width:100px;"></div></th><th style="text-align:center;">上手难度 <div style="width:100px;"></div></th><th>功能完备性 <div style="width:450px;"></div></th><th style="text-align:center;">社区和第三方<div style="width:100px;"></div></th></tr></thead><tbody><tr><td style="text-align:left;">原生 WebSocket</td><td style="text-align:center;">好</td><td style="text-align:center;">容易</td><td>无，需要自行开发</td><td style="text-align:center;">活跃</td></tr><tr><td style="text-align:left;">uni.connectSocket</td><td style="text-align:center;">好</td><td style="text-align:center;">容易</td><td>一般，只有简单封装，满足不了业务场景</td><td style="text-align:center;">活跃</td></tr><tr><td style="text-align:left;">Socket.io</td><td style="text-align:center;">一般</td><td style="text-align:center;">难</td><td>Uniapp 平台编译的 JS 版本与 Socket.io 存在兼容性，新版本的 Socket.io 会出现错误，老版本有可能可以工作，但存在很多不确定性。毕竟 Socket.io 是先出来的，后面有了 Uniapp 这个平台，但是缺少官方的适配工作，所以二者兼容性差。</td><td style="text-align:center;">活跃</td></tr></tbody></table><blockquote><p>Socket.io 在应用市场上也有第三方封装的插件。有人安装成功，也有人失败……比如我自己。。。</p></blockquote><h2 id="socket-封装" tabindex="-1"><a class="header-anchor" href="#socket-封装" aria-hidden="true">#</a> Socket 封装</h2><p>从 MDN 可以了解到，JS 的 WebSocket 对象提供了用于创建和管理 WebSocket 连接，以及可以通过该连接发送和接收数据的 API。</p><p>在这些基础 API 之上，我们需要封装以下功能：</p><ol><li>主动建立连接</li><li>心跳机制</li><li>断线重连</li><li>主动断开</li></ol><p>展示一段 MDN 的示例代码<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// Create WebSocket connection.</span>
<span class="token keyword">const</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">&quot;ws://localhost:8080&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Connection opened</span>
socket<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Server!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Listen for messages</span>
socket<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Message from server &quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>这段代码是正确的，也可以工作。但是存在以下问题：</p><ol><li>面向过程的代码调用，难以复用；</li><li>缺少封装，难以扩展；</li><li>callback hell<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>，很难直观地获得代码执行后的正确性；</li></ol><p>说了这么多，现在开始动手封装吧。</p><blockquote><p>当前主要讲述 Uniapp 平台下如何封装。</p></blockquote><h3 id="主动建立连接" tabindex="-1"><a class="header-anchor" href="#主动建立连接" aria-hidden="true">#</a> 主动建立连接</h3><p>创建简单的 Socket 连接，很难满足日常开发需求，最常见的要求就是 <strong>URL 参数拼接和支持子路径</strong>。例如：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>wss<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>socket<span class="token punctuation">.</span>serve<span class="token operator">/</span>sub<span class="token operator">-</span>path<span class="token operator">?</span>token<span class="token operator">=</span>xxxx<span class="token operator">&amp;</span>param1<span class="token operator">=</span>x<span class="token operator">&amp;</span>param2<span class="token operator">=</span>x<span class="token operator">&amp;</span>param3<span class="token operator">=</span>x<span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">&amp;</span>param<span class="token operator">=</span>x
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>API 可以这样设计：</p><ul><li><code>backendUrl</code> socket 服务地址</li><li><code>path</code> 子路径</li><li><code>query</code> URL 参数</li></ul><p>代码如下：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * 将对象转换成 URL 拼接参数
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">obj</span>
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">requestStr</span>
 * <span class="token keyword">@returns</span>
 */</span>
<span class="token keyword">const</span> obj2Params <span class="token operator">=</span> <span class="token punctuation">(</span>obj<span class="token punctuation">,</span> requestStr <span class="token operator">=</span> <span class="token string">&#39;?&#39;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> params <span class="token operator">=</span> requestStr
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> p <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    params <span class="token operator">+=</span> p <span class="token operator">+</span> <span class="token string">&#39;=&#39;</span> <span class="token operator">+</span> obj<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&#39;&amp;&#39;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> params<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> params<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
  backendUrl<span class="token operator">:</span> <span class="token string">&#39;socket.serve&#39;</span><span class="token punctuation">,</span>
  path<span class="token operator">:</span> <span class="token string">&#39;/socket.io/&#39;</span><span class="token punctuation">,</span>
  query<span class="token operator">:</span> <span class="token punctuation">{</span>
    transport<span class="token operator">:</span> <span class="token string">&#39;websocket&#39;</span><span class="token punctuation">,</span>
    token<span class="token operator">:</span> <span class="token string">&#39;your-token&#39;</span><span class="token punctuation">,</span>
    device<span class="token operator">:</span> <span class="token string">&#39;app&#39;</span><span class="token punctuation">,</span>
    <span class="token constant">EIO</span><span class="token operator">:</span> <span class="token string">&#39;4&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token function">obj2Params</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>query<span class="token punctuation">)</span>
<span class="token keyword">const</span> wsUrl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span>backendUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>query<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>

<span class="token comment">// 创建 WebSocket 连接</span>
<span class="token keyword">const</span> socketTask <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">connectSocket</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  url<span class="token operator">:</span> wsUrl<span class="token punctuation">,</span>
  <span class="token function-variable function">complete</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h3 id="心跳机制" tabindex="-1"><a class="header-anchor" href="#心跳机制" aria-hidden="true">#</a> 心跳机制</h3><blockquote><p>心跳机制是定时发送一个自定义的数据结构体，让对方知道自己还活着，以确保连接的有效性的机制。</p></blockquote><p>这里，我们参考 Socket.io，他们建立了一个 <code>ping/pong</code> 的机制<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>，用来确保客户端与服务端连接的有效性。核心代码如下：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 创建 WebSocket 连接</span>
<span class="token keyword">const</span> socketTask <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">connectSocket</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  url<span class="token operator">:</span> wsUrl<span class="token punctuation">,</span>
  <span class="token function-variable function">complete</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 心跳间隔、重连 websocket 间隔，15 秒</span>
<span class="token keyword">const</span> interval <span class="token operator">=</span> <span class="token number">15000</span>

<span class="token keyword">const</span> <span class="token function-variable function">onHeartBeat</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    socketTask<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      data<span class="token operator">:</span> <span class="token string">&#39;3&#39;</span><span class="token punctuation">,</span>
      <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\n🚀 ~ 心跳发送成功！&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;🚀 ~心跳发送失败&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> interval<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 发送心跳</span>
<span class="token function">onHeartBeat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="断线重连" tabindex="-1"><a class="header-anchor" href="#断线重连" aria-hidden="true">#</a> 断线重连</h3><p>实际生活中，由于网络延迟、错误异常或者服务器更新重启等意外突发情况，之前建立的 socket 连接可能被中断。面对这样的情况，我们该如何处理呢？</p><p>通常的做法是，在不打扰用户、用户无感的情况下，程序自动重新连接服务，确保连接正常。为了保证连接成功，<strong>一般会尝试多次，当超过连接次数的上限时，才放弃自动连接。</strong> 设置上限，是为了防止无休止的无效连接，引发其它问题。</p><p>核心代码如下：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 重新连接次数</span>
<span class="token keyword">let</span> reconnectTime <span class="token operator">=</span> <span class="token number">1</span>
<span class="token comment">// 重新连接 Timer</span>
<span class="token keyword">let</span> reconnectTimer <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token comment">// 间隔 15 秒</span>
<span class="token keyword">const</span> interval <span class="token operator">=</span> <span class="token number">15000</span>
<span class="token comment">// 重连最大次数</span>
<span class="token keyword">const</span> maxReconnectMaxTime <span class="token operator">=</span> <span class="token number">5</span>

<span class="token keyword">const</span> <span class="token function-variable function">onReconnect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">clearTimeout</span><span class="token punctuation">(</span>reconnectTimer<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>reconnectTime <span class="token operator">&lt;</span> maxReconnectMaxTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    reconnectTimer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">🚀 ~ 第【</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>reconnectTime<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">】次重新连接中……</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token comment">// 重新连接</span>
      <span class="token comment">// CreateSocket()</span>
      reconnectTime<span class="token operator">++</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> interval<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    uni<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">&#39;提示&#39;</span><span class="token punctuation">,</span>
      content<span class="token operator">:</span> <span class="token string">&#39;socket 连接失败 ~&#39;</span><span class="token punctuation">,</span>
      showCancel<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      confirmText<span class="token operator">:</span> <span class="token string">&#39;我知道了&#39;</span><span class="token punctuation">,</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// something</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 尝试重新连接</span>
<span class="token function">onReconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="主动断开" tabindex="-1"><a class="header-anchor" href="#主动断开" aria-hidden="true">#</a> 主动断开</h3><p>当用户退出登录，或者主动断开 socket 连接时。核心代码如下：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 创建 WebSocket 连接</span>
<span class="token keyword">const</span> socketTask <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">connectSocket</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  url<span class="token operator">:</span> wsUrl<span class="token punctuation">,</span>
  <span class="token function-variable function">complete</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">close</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  socketTask<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 关闭 websocket</span>
<span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="完整的代码" tabindex="-1"><a class="header-anchor" href="#完整的代码" aria-hidden="true">#</a> 完整的代码</h2><p>综合以上内容，完整代码如下：</p><details class="custom-container details"><summary>点击查看代码</summary><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">WSocket</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 状态</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">&#39;notConnected&#39;</span>
    <span class="token comment">// 配置</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options
    <span class="token comment">// WS 实例</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>socketTask <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token comment">// 心跳间隔、重连 websocket 间隔，15 秒</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>interval <span class="token operator">=</span> <span class="token number">15000</span>
    <span class="token comment">// 重连最大次数</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>maxReconnectMaxTime <span class="token operator">=</span> <span class="token number">5</span>
    <span class="token comment">// 正常关闭</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>normalCloseFlag <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token comment">// 重新连接次数</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>reconnectTime <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token comment">// 重新连接 Timer</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>reconnectTimer <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token comment">// 心跳 Timer</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>heartTimer <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token comment">// 发起连接</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initSocket</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>token<span class="token punctuation">)</span>

    <span class="token comment">// 关闭 WS</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">close</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 正常关闭状态</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>normalCloseFlag <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token comment">// 关闭 websocket</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>socketTask<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// 关闭心跳定时器</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>heartTimer<span class="token punctuation">)</span>
      <span class="token comment">// 关闭重连定时器</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reconnectTimer<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token doc-comment comment">/**
   * 将对象转换成 URL 拼接参数
   * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">obj</span>
   * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">requestStr</span>
   * <span class="token keyword">@returns</span>
   */</span>
  <span class="token function">obj2Params</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> requestStr<span class="token operator">=</span> <span class="token string">&#39;?&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> params <span class="token operator">=</span>requestStr
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> p <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      params <span class="token operator">+=</span> p <span class="token operator">+</span> <span class="token string">&#39;=&#39;</span> <span class="token operator">+</span> obj<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&#39;&amp;&#39;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> params<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> params<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">getBackEndUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>ncsUrl <span class="token operator">&amp;&amp;</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>ncsUrl<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>
      <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">https:\/\/([^/]+)\/api\/ncs_msg</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span>
      <span class="token string">&#39;wss://$1&#39;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">getSocketUrl</span><span class="token punctuation">(</span><span class="token parameter">token</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
      backEndUrl<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getBackEndUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      path<span class="token operator">:</span> <span class="token string">&#39;/socket.io/&#39;</span><span class="token punctuation">,</span>
      query<span class="token operator">:</span> <span class="token punctuation">{</span>
        transport<span class="token operator">:</span> <span class="token string">&#39;websocket&#39;</span><span class="token punctuation">,</span>
        token<span class="token punctuation">,</span>
        device<span class="token operator">:</span> <span class="token string">&#39;app&#39;</span><span class="token punctuation">,</span>
        <span class="token constant">EIO</span><span class="token operator">:</span> <span class="token string">&#39;4&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">obj2Params</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>query<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span>backEndUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>query<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span>

  <span class="token function">getSocketTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>socketTask
  <span class="token punctuation">}</span>

  <span class="token function">initSocket</span><span class="token punctuation">(</span><span class="token parameter">token</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span>
      <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;Socket init failed, token is required !!!&#39;</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> socketUrl <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSocketUrl</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>

    <span class="token comment">// 创建 WebSocket 连接</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>socketTask <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">connectSocket</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      url<span class="token operator">:</span> socketUrl<span class="token punctuation">,</span>
      <span class="token function-variable function">complete</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">watchWS</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">watchWS</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 监听 WebSocket 连接打开事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>socketTask<span class="token punctuation">.</span><span class="token function">onOpen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">&#39;connected&#39;</span>
      <span class="token comment">// 连接成功</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>onConnected <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span><span class="token function">onConnected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>socketTask<span class="token punctuation">)</span>
      <span class="token comment">// 重置连接次数</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>reconnectTime <span class="token operator">=</span> <span class="token number">1</span>
      <span class="token comment">// 发送心跳</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onHeartBeat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// 监听消息</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// 关闭 Toast</span>
      uni<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 监听 websocket 错误</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>socketTask<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 关闭并重连</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>socketTask<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 监听 WebSocket 连接关闭事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>socketTask<span class="token punctuation">.</span><span class="token function">onClose</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 连接错误，发起重连接</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>normalCloseFlag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onDisconnected</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 监听消息</span>
  <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 监听 websocket 收到消息</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>socketTask<span class="token punctuation">.</span><span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">//收到消息</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>onMessage <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span><span class="token function">onMessage</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&#39;🚀 ~ Not listening to the message, reason:&#39;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 断开连接</span>
  <span class="token function">onDisconnected</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">&#39;notConnected&#39;</span>
    <span class="token comment">// 关闭心跳</span>
    <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>heartTimer<span class="token punctuation">)</span>
    <span class="token comment">// 尝试重新连接</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onReconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token doc-comment comment">/** 断线重连 */</span>
  <span class="token function">onReconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reconnectTimer<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reconnectTime <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxReconnectMaxTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>reconnectTimer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">🚀 ~ Reconnect for the 【</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>reconnectTime<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 】 time</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token comment">// 重新连接</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initSocket</span><span class="token punctuation">(</span><span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>token<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>reconnectTime<span class="token operator">++</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>interval<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      uni<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        title<span class="token operator">:</span> <span class="token string">&#39;tips&#39;</span><span class="token punctuation">,</span>
        content<span class="token operator">:</span> <span class="token string">&#39;socket Connection failed ~&#39;</span><span class="token punctuation">,</span>
        showCancel<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        confirmText<span class="token operator">:</span> <span class="token string">&#39;I got it.&#39;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// something</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token doc-comment comment">/** 心跳检查 **/</span>
  <span class="token function">onHeartBeat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>heartTimer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>socketTask<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        data<span class="token operator">:</span> <span class="token string">&#39;3&#39;</span><span class="token punctuation">,</span>
        <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\n🚀 ~ Heartbeat Sent Successfully!&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;🚀 ~ Heartbeat Send Failure&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>interval<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 对外暴露实例化方法</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">createSocket</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">WSocket</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br></div></div></details><p>调用方式</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token function">createNCSocket</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  token<span class="token punctuation">,</span>
  <span class="token function-variable function">onMessage</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// some thing</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 获取 ws 实例</span>
ws<span class="token punctuation">.</span><span class="token function">getSocketTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 注册监听事件</span>
ws<span class="token punctuation">.</span><span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 关闭 ws</span>
ws<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="ref" tabindex="-1"><a class="header-anchor" href="#ref" aria-hidden="true">#</a> Ref</h2><ul><li><a href="https://juejin.cn/post/7144913531664597029" target="_blank" rel="noopener noreferrer">uniapp 即时聊天 websocket 封装（建立连接、断线重连、心跳机制、主动关闭）使用 SocketTask 的方式 - 掘金<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li><li><a href="https://juejin.cn/post/7438840219438301221" target="_blank" rel="noopener noreferrer">基于 uniapp 使用 websocket 进行实时通讯最近在做一个赛事的需求，需要使用实时通讯实现房间内交换位置，转让房主， - 掘金<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li><li><a href="https://juejin.cn/post/6933833582716813325" target="_blank" rel="noopener noreferrer">uni-app 使用 websocket（心跳机制）1. 为什么叫心跳包呢？它就像心跳一样每隔固定的时间发一次，来告诉服务 - 掘金<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li><li><a href="https://juejin.cn/post/7425822400178470949" target="_blank" rel="noopener noreferrer">WebSocket 心跳机制的原理你知道多少？为什么需要心跳检测？正常的情况客户端断开连接会向服务端发送一个 fin 包，服 - 掘金<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li><li><a href="https://juejin.cn/post/7346919387353219106" target="_blank" rel="noopener noreferrer">为什么面试官都爱问 websocket？什么是 webSocket？简单来说：webSocket 就是服务器和客户端相互主动 - 掘金<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li><li><a href="https://juejin.cn/post/7346471697162649634" target="_blank" rel="noopener noreferrer">5 分钟从 0 到 1，学会 webSocket 的使用什么是 webSocket？优点：基于 TCP 协议：WebSocket 建立 - 掘金<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li><li><a href="https://uniapp.dcloud.net.cn/api/request/websocket.html" target="_blank" rel="noopener noreferrer">uni.connectSocket(OBJECT) | uni-app 官网<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li><li><a href="https://juejin.cn/post/7371365854012276747" target="_blank" rel="noopener noreferrer">赶快收藏！全网最佳 websocket 封装：完美支持断网重连、自动心跳！简介 websocket 在前端开发中，是一个必须掌 - 掘金<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li></ul><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket" target="_blank" rel="noopener noreferrer">WebSocket - Web API | MDN<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p><a href="http://callbackhell.com/" target="_blank" rel="noopener noreferrer">回调地狱 --- Callback Hell<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> <a href="#fnref2" class="footnote-backref">↩︎</a></p></li><li id="fn3" class="footnote-item"><p><a href="https://socket.io/zh-CN/how-to/build-a-basic-client#heartbeat" target="_blank" rel="noopener noreferrer">How to build a basic Socket.IO client | Socket.IO<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> <a href="#fnref3" class="footnote-backref">↩︎</a></p></li></ol></section><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">6/9/2025, 9:37:42 AM</span></div><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/uniapp/global-toast-components/" class="nav-link" aria-label="toast_另类全局组件的实现"><!--[--><!--]--> toast_另类全局组件的实现 <!--[--><!--]--></a></span><span class="next"><a href="/uniapp/uniapp-how-to-debug-a-web-project/" class="nav-link" aria-label="Uniapp：Web 项目如何 debug?"><!--[--><!--]--> Uniapp：Web 项目如何 debug? <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.90fa381f.js" defer></script>
  </body>
</html>
