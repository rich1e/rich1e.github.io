<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/16x16.png"><link rel="shortcut icon" href="/images/favicon/favicon.ico"><link rel="stylesheet" href="/css/index.css"><title>如何抓取socket流量包？ | Personal Hobbies</title><meta name="description" content="Just playing around">
    <link rel="modulepreload" href="/assets/app.90fa381f.js"><link rel="modulepreload" href="/assets/index.html.fe15aac9.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.5a098b48.js"><link rel="modulepreload" href="/assets/index.html.71ec4e79.js">
    <link rel="stylesheet" href="/assets/style.877cd0e4.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container no-sidebar"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">Personal Hobbies</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/lifestyle/" class="nav-link" aria-label="生活"><!--[--><!--]--> 生活 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/meditate/" class="nav-link" aria-label="思考"><!--[--><!--]--> 思考 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/traveling/" class="nav-link" aria-label="旅游"><!--[--><!--]--> 旅游 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="√get"><span class="title">√get</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="√get"><span class="title">√get</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/note/" class="nav-link" aria-label="便签"><!--[--><!--]--> 便签 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/data-structures-and-algorithms/" class="nav-link" aria-label="数据结构与算法"><!--[--><!--]--> 数据结构与算法 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/javascript-note/" class="nav-link" aria-label="javascript 笔记"><!--[--><!--]--> javascript 笔记 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/handwritten-code/" class="nav-link" aria-label="手写代码"><!--[--><!--]--> 手写代码 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/leetcode/" class="nav-link" aria-label="LeetCode"><!--[--><!--]--> LeetCode <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/web-development/" class="nav-link" aria-label="Web Development"><!--[--><!--]--> Web Development <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/uniapp/" class="nav-link" aria-label="Uniapp"><!--[--><!--]--> Uniapp <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/git/" class="nav-link" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/workspace/" class="nav-link router-link-active" aria-label="Workspace"><!--[--><!--]--> Workspace <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/rich1e" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/lifestyle/" class="nav-link" aria-label="生活"><!--[--><!--]--> 生活 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/meditate/" class="nav-link" aria-label="思考"><!--[--><!--]--> 思考 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/traveling/" class="nav-link" aria-label="旅游"><!--[--><!--]--> 旅游 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="√get"><span class="title">√get</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="√get"><span class="title">√get</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/note/" class="nav-link" aria-label="便签"><!--[--><!--]--> 便签 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/data-structures-and-algorithms/" class="nav-link" aria-label="数据结构与算法"><!--[--><!--]--> 数据结构与算法 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/javascript-note/" class="nav-link" aria-label="javascript 笔记"><!--[--><!--]--> javascript 笔记 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/handwritten-code/" class="nav-link" aria-label="手写代码"><!--[--><!--]--> 手写代码 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/leetcode/" class="nav-link" aria-label="LeetCode"><!--[--><!--]--> LeetCode <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/web-development/" class="nav-link" aria-label="Web Development"><!--[--><!--]--> Web Development <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/uniapp/" class="nav-link" aria-label="Uniapp"><!--[--><!--]--> Uniapp <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/git/" class="nav-link" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/workspace/" class="nav-link router-link-active" aria-label="Workspace"><!--[--><!--]--> Workspace <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/rich1e" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="如何抓取socket流量包" tabindex="-1"><a class="header-anchor" href="#如何抓取socket流量包" aria-hidden="true">#</a> 如何抓取socket流量包？</h1><nav class="table-of-contents"><ul><li><a aria-current="page" href="/workspace/How-to-capture-socket-traffic-packets/#🎬场景一-charles-proxifier-模拟器-推荐" class="router-link-active router-link-exact-active">🎬场景一：Charles + Proxifier + 模拟器（推荐）</a><ul><li><a aria-current="page" href="/workspace/How-to-capture-socket-traffic-packets/#步骤1-配置charles的socket代理" class="router-link-active router-link-exact-active">步骤1：配置Charles的Socket代理</a></li><li><a aria-current="page" href="/workspace/How-to-capture-socket-traffic-packets/#步骤2-配置mac系统代理" class="router-link-active router-link-exact-active">步骤2：配置Mac系统代理</a></li><li><a aria-current="page" href="/workspace/How-to-capture-socket-traffic-packets/#步骤3-在模拟器中安装charles证书" class="router-link-active router-link-exact-active">步骤3：在模拟器中安装Charles证书</a></li><li><a aria-current="page" href="/workspace/How-to-capture-socket-traffic-packets/#步骤4-配置proxifier" class="router-link-active router-link-exact-active">步骤4：配置Proxifier</a></li><li><a aria-current="page" href="/workspace/How-to-capture-socket-traffic-packets/#步骤5-捕获socket流量" class="router-link-active router-link-exact-active">步骤5：捕获Socket流量</a></li></ul></li><li><a aria-current="page" href="/workspace/How-to-capture-socket-traffic-packets/#🎬场景二-真机-charles-shadowrocket" class="router-link-active router-link-exact-active">🎬场景二：真机 + Charles + Shadowrocket</a><ul><li><a aria-current="page" href="/workspace/How-to-capture-socket-traffic-packets/#步骤1-配置charles的socket代理-1" class="router-link-active router-link-exact-active">步骤1：配置Charles的Socket代理</a></li><li><a aria-current="page" href="/workspace/How-to-capture-socket-traffic-packets/#步骤2-配置shadowrocket代理" class="router-link-active router-link-exact-active">步骤2：配置Shadowrocket代理</a></li><li><a aria-current="page" href="/workspace/How-to-capture-socket-traffic-packets/#步骤3-捕获socket流量" class="router-link-active router-link-exact-active">步骤3：捕获Socket流量</a></li></ul></li></ul></nav><h2 id="🎬场景一-charles-proxifier-模拟器-推荐" tabindex="-1"><a class="header-anchor" href="#🎬场景一-charles-proxifier-模拟器-推荐" aria-hidden="true">#</a> 🎬场景一：Charles + Proxifier + 模拟器（推荐）</h2><p>这个方案的好处是，不需要移动设备即可调试。但也有一些瑕疵，抓包数据中host变成了ip地址。估计是因为流量被转发了，拿不到原始的请求信息。</p><h3 id="步骤1-配置charles的socket代理" tabindex="-1"><a class="header-anchor" href="#步骤1-配置charles的socket代理" aria-hidden="true">#</a> <strong>步骤1：配置Charles的Socket代理</strong></h3><ol><li><p><strong>启动Charles</strong>，进入菜单栏选择 <strong>Proxy &gt; Proxy Settings</strong>。</p></li><li><p>在 <strong>SOCKS Proxy</strong> 选项卡中：</p><ul><li><p>勾选 <strong>Enable SOCKS Proxy</strong>。</p></li><li><p>设置端口（例如 <code>8889</code>，避免与HTTP代理端口冲突）。</p></li></ul></li><li><p>在 <strong>SSL Proxying Settings</strong> 中添加需要解密的域名或通配符（如 <code>*:*</code> 以捕获所有SSL流量）。</p></li></ol><div style="display:flex;align-items:center;"><img src="/assets/Pasted_image_20250213145145.7c5b6f32.png" alt="1" style="width:50%;"><p><img src="/assets/Pasted_image_20250213145228.02426732.png" alt="1" style="margin-left:10px;"></p></div><h3 id="步骤2-配置mac系统代理" tabindex="-1"><a class="header-anchor" href="#步骤2-配置mac系统代理" aria-hidden="true">#</a> <strong>步骤2：配置Mac系统代理</strong></h3><ol><li><p>打开 <strong>系统偏好设置 &gt; 网络 &gt; 高级 &gt; 代理</strong>。</p></li><li><p>启用 <strong>SOCKS Proxy</strong>，填写：</p><ul><li><p><strong>服务器</strong>: <code>127.0.0.1</code></p></li><li><p><strong>端口</strong>: Charles设置的SOCKS端口（如 <code>8889</code>）。</p></li></ul></li><li><p>确保iOS模拟器继承此代理（模拟器默认共享Mac网络设置）。</p></li></ol><p><img src="/assets/Pasted_image_20250213145315.d2c09582.png" alt="1" style="width:50%;margin:0 auto;display:block;"></p><h3 id="步骤3-在模拟器中安装charles证书" tabindex="-1"><a class="header-anchor" href="#步骤3-在模拟器中安装charles证书" aria-hidden="true">#</a> <strong>步骤3：在模拟器中安装Charles证书</strong></h3><ol><li><p>在模拟器中打开Safari，访问 <code>http://chls.pro/ssl</code> 下载证书。</p></li><li><p>安装证书后，进入 <strong>设置 &gt; 通用 &gt; 关于 &gt; 证书信任设置</strong>，启用对Charles证书的完全信任。</p></li></ol><div style="display:flex;align-items:center;"><img src="/assets/Pasted_image_20250213145414.b73caefb.png" alt="1" style="width:33.3333333%;"><p><img src="/assets/Pasted_image_20250213145353.745b31fa.png" alt="1" style="margin-left:10px;"></p><p><img src="/assets/Pasted_image_20250213145446.aa0668e9.png" alt="1" style="margin-left:20px;"></p></div><h3 id="步骤4-配置proxifier" tabindex="-1"><a class="header-anchor" href="#步骤4-配置proxifier" aria-hidden="true">#</a> <strong>步骤4：配置Proxifier</strong></h3><ol><li><p><strong>新增代理</strong>。Proxy 配置为 Charles 的 HTTP 代理地址，端口为 <code>8888</code>。</p></li><li><p><strong>设置代理规则</strong>。修改 <code>Default</code> 规则，打开 <code>Action</code> ，选择刚刚新增的 <code>Proxy HTTPS 127.0.0.1:8888</code>。</p></li><li><p><strong>修改DNS配置</strong>。编辑 <strong>Proxifier DNS Settings</strong>，选择 <code>Resolve hostnames through proxy</code>。</p></li></ol><p><img src="/assets/Pasted_image_20250213145550.d4824aa1.png" alt="1" style="width:50%;margin:0 auto;display:block;"></p><p><img src="/assets/Pasted_image_20250213145649.c83e8f20.png" alt="1" style="width:50%;margin:0 auto;display:block;"></p><p><img src="/assets/Pasted_image_20250213145710.48f3dcf2.png" alt="1" style="width:50%;margin:0 auto;display:block;"></p><h3 id="步骤5-捕获socket流量" tabindex="-1"><a class="header-anchor" href="#步骤5-捕获socket流量" aria-hidden="true">#</a> <strong>步骤5：捕获Socket流量</strong></h3><ol><li><p>配置完成后，<strong>重启<code>Proxifier</code></strong>, 最好也<strong>重启下<code>Charles</code></strong>，以确保配置生效。</p></li><li><p>在Charles中点击 <strong>Start Recording</strong>（红色圆点图标）。</p></li><li><p>运行模拟器中的应用，触发Socket连接。</p></li><li><p>在Charles的 <strong>Structure</strong> 或 <strong>Sequence</strong> 视图中查看原始TCP流量（可能需要展开对应主机）。</p></li></ol><blockquote><p>截图中均出现了，<code>80fa3d23-f568-460f-9b4d-856381d2332a</code>。第一张图是 <strong>console.log</strong> 打印的日志，第二张图是 <strong>Charles</strong> 里面抓取的数据。</p></blockquote><p><img src="/assets/Pasted_image_20250213150335.cdf49c72.png" alt="1" style="margin:0 auto;display:block;"></p><p><img src="/assets/Pasted_image_20250213150342.711399d7.png" alt="1" style="width:50%;margin:0 auto;display:block;"></p><h2 id="🎬场景二-真机-charles-shadowrocket" tabindex="-1"><a class="header-anchor" href="#🎬场景二-真机-charles-shadowrocket" aria-hidden="true">#</a> 🎬场景二：真机 + Charles + Shadowrocket</h2><p>这里需要用到真机，还需要在真机里面安装 Shadowrocket 应用。</p><h3 id="步骤1-配置charles的socket代理-1" tabindex="-1"><a class="header-anchor" href="#步骤1-配置charles的socket代理-1" aria-hidden="true">#</a> <strong>步骤1：配置Charles的Socket代理</strong></h3><p>略，同上。</p><h3 id="步骤2-配置shadowrocket代理" tabindex="-1"><a class="header-anchor" href="#步骤2-配置shadowrocket代理" aria-hidden="true">#</a> <strong>步骤2：配置Shadowrocket代理</strong></h3><ol><li><p><strong>安装Shadowrocket</strong>。</p></li><li><p>网络配置，<strong>手机与电脑要在同一个网络</strong>。</p></li><li><p><strong>配置手机代理</strong>，打开网络设置，找到配置代理，将服务器设置为电脑的局域网IP：<code>192.168.110.113</code>，端口<code>8888</code>（这个端口被Charles监听）。</p></li><li><p><strong>配置Shadowrocket</strong>，新增代理服务，类型为Socks5，地址设置为电脑的局域网IP：<code>192.168.110.113</code>，端口<code>8889</code>（这个端口被Charles监听）。</p></li></ol><div style="display:flex;align-items:center;"><img src="/assets/Pasted_image_20250213152203.945f0312.png" alt="1" style="width:50%;"><p><img src="/assets/Pasted_image_20250213151534.2f9704b4.png" alt="1" style="margin-left:10px;"></p></div><h3 id="步骤3-捕获socket流量" tabindex="-1"><a class="header-anchor" href="#步骤3-捕获socket流量" aria-hidden="true">#</a> <strong>步骤3：捕获Socket流量</strong></h3><ol><li><p>配置完成后，<strong>重启下<code>Charles</code></strong>，以确保配置生效。</p></li><li><p>在Charles中点击 <strong>Start Recording</strong>（红色圆点图标）。</p></li><li><p>打开手机中的app应用，触发Socket连接。</p></li><li><p>在Charles的 <strong>Structure</strong> 或 <strong>Sequence</strong> 视图中查看原始TCP流量（可能需要展开对应主机）。</p></li></ol><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">2/14/2025, 9:25:40 AM</span></div><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.90fa381f.js" defer></script>
  </body>
</html>
